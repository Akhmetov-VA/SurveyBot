
# SurveyBot

## Обзор

**SurveyBot** — это комплексное решение для проведения различных типов опросов, включая периодические опросы удовлетворенности (вовлеченности), фокус-группы, пульс-опросы, опросы уволившихся сотрудников и соискателей. Проект состоит из трех основных компонентов:

1. **MongoDB**: База данных для хранения пользователей, опросов, ответов и информации о расписании.
2. **Streamlit Административная Панель**: Веб-интерфейс для администраторов для управления пользователями, опросами, расписаниями и статусами.
3. **Telegram Бот**: Интерфейс для пользователей для взаимодействия с опросами через Telegram.

Проект использует **Poetry** для управления зависимостями и **Docker** для контейнеризации, обеспечивая стабильную и масштабируемую среду развертывания.

## Возможности

- **Управление пользователями**: Регистрация и управление пользователями, обновление их статусов и назначение опросов на основе их ролей или статусов.
- **Управление опросами**: Создание, просмотр и анализ различных типов опросов, включая CSI и открытые вопросы.
- **Планирование**: Планирование отправки опросов пользователям на регулярной основе по заданным частотам.
- **Аналитика**: Анализ ответов на опросы с помощью статистических метрик, облаков слов и анализа настроений.
- **Интеграция с Telegram**: Пользователи могут взаимодействовать с опросами непосредственно через Telegram, получая уведомления и отправляя ответы.

## Предварительные требования

- **Docker**: Убедитесь, что Docker установлен на вашей системе. [Установка Docker](https://docs.docker.com/get-docker/)
- **Docker Compose**: Входит в состав Docker Desktop. Если нет, следуйте [гайду по установке](https://docs.docker.com/compose/install/).
- **Poetry**: Для управления зависимостями (опционально, так как Docker обрабатывает зависимости). [Установка Poetry](https://python-poetry.org/docs/#installation)

## Структура Проекта

```
SurveyBot/
├── Dockerfile
├── docker-compose.yml
├── pyproject.toml
├── poetry.lock
├── db.py
├── streamlit_app.py
├── bot.py
├── config.py
└── README.md
```

- `Dockerfile`: Определяет Docker-образ для Streamlit приложения и Telegram бота.
- `docker-compose.yml`: Оркестрирует сервисы MongoDB, Streamlit приложения и Telegram бота.
- `pyproject.toml` & `poetry.lock`: Управляют зависимостями проекта с помощью Poetry.
- `db.py`: Модуль для взаимодействия с MongoDB.
- `streamlit_app.py`: Streamlit-панель администратора.
- `bot.py`: Реализация Telegram бота.
- `config.py`: Файл конфигурации для переменных окружения и настроек.
- `README.md`: Документация проекта.

## Настройка и Установка

### 1. Клонируйте Репозиторий

```bash
git clone https://github.com/yourusername/SurveyBot.git
cd SurveyBot
```

### 2. Настройте Переменные Окружения

Создайте файл `.env` в корневой директории проекта для хранения чувствительной информации, такой как токены и учетные данные базы данных.

```env
# .env

MONGO_INITDB_ROOT_USERNAME=root
MONGO_INITDB_ROOT_PASSWORD=example
MONGO_HOST=mongodb
MONGO_INITDB_ROOT_PORT=27017
MONGODB_DB_NAME=your_db_name
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
ADMIN_IDS=admin_id1,admin_id2
```

**Примечание:**
- Замените `your_telegram_bot_token_here` на фактический токен вашего Telegram бота.
- `ADMIN_IDS` — это список Telegram ID администраторов, разделенных запятыми.

### 3. Постройте и Запустите Контейнеры

Используйте Docker Compose для сборки Docker-образа и запуска всех сервисов.

```bash
docker-compose up --build
```

- **Первый Запуск:** Docker Compose соберет образ, установит зависимости и запустит все сервисы.
- **Последующие Запуски:** Просто выполните `docker-compose up` для запуска сервисов без пересборки, если изменения не были внесены.

### 4. Доступ к Административной Панели

После запуска контейнеров:

- Откройте веб-браузер и перейдите по адресу [http://localhost:8501](http://localhost:8501) для доступа к Streamlit административной панели.

### 5. Взаимодействие с Telegram Ботом

- Откройте Telegram и найдите вашего бота по его имени пользователя.
- Начните взаимодействие с ботом, отправив команду `/start`.
- Следуйте подсказкам для регистрации и участия в опросах.

## Управление Сервисами

### Запуск Сервисов

```bash
docker-compose up -d
```

- Флаг `-d` запускает контейнеры в фоновом режиме (detached mode).

### Остановка Сервисов

```bash
docker-compose down
```

- Эта команда останавливает и удаляет все контейнеры, определенные в `docker-compose.yml`.

### Просмотр Логов

```bash
docker-compose logs -f
```

- Флаг `-f` позволяет просматривать логи в реальном времени.

### Пересборка Контейнеров

Если вы внесли изменения в код или зависимости:

```bash
docker-compose up --build
```

### Доступ к MongoDB Shell

Для взаимодействия с экземпляром MongoDB:

```bash
docker exec -it mongodb mongo -u root -p example --authenticationDatabase admin
```

- Эта команда открывает MongoDB shell с предоставленными учетными данными.

## Добавление Нового Опроса

1. **Доступ к Административной Панели:** Перейдите на [http://localhost:8501](http://localhost:8501).
2. **Перейдите на вкладку "Опросы":** Используйте интерфейс Streamlit для создания нового опроса, указав название и добавив вопросы.
3. **Назначение Опросов:** Назначьте созданный опрос пользователям или статусам через панель.
4. **Планирование Опросов:** Используйте вкладку "Расписание" для планирования отправки опросов.

## Мониторинг и Аналитика

- **CSI Вопросы:** Анализируйте ответы с помощью средних значений, стандартных отклонений и гистограмм распределения.
- **Открытые Вопросы:** Генерируйте облака слов и проводите анализ настроений для понимания отзывов пользователей.

## Решение Проблем

- **Проблемы с Подключением к MongoDB:**
  - Убедитесь, что сервис MongoDB запущен.
  - Проверьте переменные окружения в файле `.env`.
  - Проверьте логи Docker для MongoDB: `docker-compose logs mongodb`

- **Telegram Бот Не Отвечает:**
  - Убедитесь, что токен бота корректен в файле `.env`.
  - Проверьте логи Docker для бота: `docker-compose logs telegram_bot`

- **Streamlit Приложение Недоступно:**
  - Убедитесь, что сервис Streamlit запущен.
  - Проверьте логи Docker для Streamlit приложения: `docker-compose logs streamlit_app`

## Вклад

Вклады приветствуются! Пожалуйста, форкните репозиторий и отправьте pull request для любых улучшений или исправлений ошибок.

## Лицензия

Этот проект лицензирован по лицензии [MIT License](LICENSE).

## Контакты

По любым вопросам или для поддержки, пожалуйста, свяжитесь с [your.email@example.com](mailto:your.email@example.com).
```

**Пояснение:**

- **Обзор:** Описание проекта и его компонентов.
- **Возможности:** Перечень основных функций проекта.
- **Предварительные требования:** Необходимые инструменты для запуска проекта.
- **Структура Проекта:** Объяснение структуры файлов и папок.
- **Настройка и Установка:** Пошаговая инструкция по клонированию репозитория, настройке `.env` файла и запуску сервисов через Docker Compose.
- **Управление Сервисами:** Команды для запуска, остановки и просмотра логов.
- **Добавление Нового Опроса:** Как создавать и назначать опросы через административную панель.
- **Мониторинг и Аналитика:** Возможности аналитики ответов на опросы.
- **Решение Проблем:** Часто возникающие проблемы и способы их решения.
- **Вклад:** Информация о том, как можно внести свой вклад в проект.
- **Лицензия:** Информация о лицензии проекта.
- **Контакты:** Контактная информация для связи.

---

## Дополнительные Шаги

### 1. Создание Файла `.env`

Создайте файл `.env` в корневой директории проекта и добавьте в него следующие переменные:

```env
# .env

MONGO_INITDB_ROOT_USERNAME=root
MONGO_INITDB_ROOT_PASSWORD=example
MONGO_HOST=mongodb
MONGO_INITDB_ROOT_PORT=27017
MONGODB_DB_NAME=TrustLLM_ru
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
ADMIN_IDS=77269896,admin_id2
```

**Примечания:**

- **MONGO_INITDB_ROOT_USERNAME и MONGO_INITDB_ROOT_PASSWORD:** Учетные данные для доступа к MongoDB.
- **MONGO_HOST и MONGO_INITDB_ROOT_PORT:** Хост и порт MongoDB (обычно `mongodb` и `27017`).
- **MONGODB_DB_NAME:** Имя базы данных, используемой проектом.
- **TELEGRAM_BOT_TOKEN:** Токен вашего Telegram бота.
- **ADMIN_IDS:** Список Telegram ID администраторов, разделенных запятыми.

### 2. Добавление `.env` в `.gitignore`

Для безопасности рекомендуется добавить файл `.env` в `.gitignore`, чтобы он не попадал в репозиторий.

```gitignore
# .gitignore

.env
```

### 3. Запуск Проекта

После настройки всех файлов выполните следующие команды:

1. **Постройте и Запустите Контейнеры:**

   ```bash
   docker-compose up --build
   ```

2. **Доступ к Административной Панели:**

   Перейдите в браузере по адресу [http://localhost:8501](http://localhost:8501).

3. **Взаимодействие с Telegram Ботом:**

   - Откройте Telegram и найдите вашего бота.
   - Отправьте команду `/start` для начала взаимодействия.

### 4. Остановка Проекта

Чтобы остановить все сервисы, выполните:

```bash
docker-compose down
```

---

## Заключение

Теперь ваш проект **SurveyBot** полностью настроен для использования Docker и Docker Compose. Вы можете легко управлять сервисами, масштабировать их при необходимости и обеспечивать стабильную работу вашего приложения. Если возникнут дополнительные вопросы или потребуется помощь, не стесняйтесь обращаться!

Если вы хотите внести изменения в код или зависимости, не забудьте пересобрать Docker-образ:

```bash
docker-compose up --build
```
